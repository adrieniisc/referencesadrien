<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ReferencesAdrien</title>
  <style>
    /* --------------------------------------------------
       Apple-Inspired Dark Mode Variables
    -------------------------------------------------- */
    :root {
      --primary-bg: #1c1c1e;
      --secondary-bg: #2c2c2e;
      --border-color: #3a3a3c;
      --text-color: #f2f2f7;
      --highlight-color: #0a84ff;
      --thumbnail-size: 300px; /* THUNAIL/IMAGE SIZE */
    }
    /* --------------------------------------------------
       Base Reset & Body
    -------------------------------------------------- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
                   Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
      background-color: var(--primary-bg);
      color: var(--text-color);
    }
    body { display: flex; flex-direction: column; }

    /* --------------------------------------------------
       Top Bar
    -------------------------------------------------- */
    .top-bar {
      background-color: var(--secondary-bg);
      padding: 0.4rem 0.8rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .top-bar button {
      background-color: var(--highlight-color);
      color: #fff;
      border: none;
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      font-size: 0.85rem;
      cursor: pointer;
    }
    .top-bar button:hover { opacity: 0.9; }

    /* --------------------------------------------------
       Main Container (Sidebar + Content)
    -------------------------------------------------- */
    .main-container {
      flex: 1;
      display: flex;
      overflow: hidden;
    }

    /* --------------------------------------------------
       Sidebar (Folders, Search & Filter)
    -------------------------------------------------- */
    .sidebar {
      width: 220px;
      background-color: var(--secondary-bg);
      border-right: 1px solid var(--border-color);
      padding: 0.8rem;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .search-bar-container {
      display: flex;
      align-items: center;
      margin-bottom: 0.6rem;
    }
    #imageSearch {
      flex: 1;
      padding: 0.3rem 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background-color: #1c1c1e;
      color: var(--text-color);
      font-size: 0.75rem;
    }
    .filter-icon-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      margin-left: 0.4rem;
    }
    .filter-button {
      width: 28px;
      height: 28px;
      background: none;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .filter-button:hover { background-color: #3a3a3c; }
    .filter-button svg {
      width: 18px;
      height: 18px;
      fill: var(--text-color);
    }
    .filter-menu {
      position: fixed;
      top: 50px;
      left: 240px;
      background-color: #2c2c2e;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 0.2rem 0;
      display: none;
      z-index: 1000;
      min-width: 120px;
      font-size: 0.75rem;
    }
    .filter-menu .filter-option {
      padding: 0.3rem 0.8rem;
      cursor: pointer;
      transition: background-color 0.2s ease;
      color: var(--text-color);
    }
    .filter-menu .filter-option:hover { background-color: #3a3a3c; }
    .folder-list {
      list-style: none;
      flex: 1;
      margin: 0;
      padding: 0;
      font-size: 0.75rem;
    }
    .folder-list > li {
      margin: 0.1rem 0;
      padding: 0.3rem 0.4rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
      text-align: left;
    }
    .folder-list > li.all { font-weight: 600; }
    .folder-list li:hover { background-color: #3a3a3c; }
    .folder-list li.selected {
      background-color: var(--highlight-color);
      color: #fff;
    }
    ul.subfolder-list {
      list-style: none;
      padding-left: 1rem;
      margin: 0.1rem 0;
      border-left: 1px solid rgba(255,255,255,0.08);
      display: none;
      font-size: 0.75rem;
    }
    ul.subfolder-list li {
      margin: 0.1rem 0;
      padding: 0.3rem 0.4rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    ul.subfolder-list li:hover { background-color: #3a3a3c; }
    ul.subfolder-list li.selected {
      background-color: var(--highlight-color);
      color: #fff;
    }
    .sidebar-footer {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      margin-top: auto;
      padding-top: 0.8rem;
      border-top: 1px solid rgba(255,255,255,0.08);
    }
    .sidebar-footer button {
      background-color: #444;
      color: #ddd;
      border: none;
      padding: 0.4rem 0.5rem;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
      width: 100%;
      text-align: center;
    }
    .sidebar-footer button:hover { opacity: 0.9; }

    /* --------------------------------------------------
       Main Content (Gallery)
    -------------------------------------------------- */
    .main-content {
      flex: 1;
      padding: 0.8rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
    }
    .image-container {
      position: relative;
      width: var(--thumbnail-size);
      min-width: var(--thumbnail-size);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .image-container img {
      width: 100%;
      height: auto;
      border: 1px solid #444;
      border-radius: 6px;
      transition: transform 0.3s ease;
      cursor: pointer;
    }
    .image-container img:hover { transform: scale(1.02); }
    .download-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background-color: var(--highlight-color);
      color: #fff;
      border: none;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.65rem;
      display: none;
      text-decoration: none;
      line-height: 1.4;
    }
    .image-container:hover .download-btn { display: block; }
    .hidden { display: none; }

    /* --------------------------------------------------
       Floating Size Panel
    -------------------------------------------------- */
    .floating-size-panel {
      position: fixed;
      bottom: 15px;
      right: 15px;
      left: auto;
      width: auto;
      transform: none;
      background-color: rgba(44,44,46,0.9);
      border-radius: 10px;
      z-index: 1000;
      display: inline-flex;
      align-items: center;
      justify-content: flex-end;
      padding: 6px;
      max-width: max-content;
    }
    .size-icon-container { 
      display: inline-flex; 
      gap: 6px; 
    }
    .size-icon {
      width: 36px;
      height: 36px;
      background-color: #1c1c1e;
      border: 1px solid #555;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 0.7rem;
      color: var(--text-color);
      transition: background-color 0.2s, border-color 0.2s;
    }
    .size-icon span { pointer-events: none; }
    .size-icon:hover { border-color: var(--highlight-color); }
    .size-icon.selected {
      background-color: var(--highlight-color);
      border-color: var(--highlight-color);
      color: #fff;
    }

    /* --------------------------------------------------
       Modals (Folder, Image, Rename)
    -------------------------------------------------- */
    .modal-backdrop {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.3);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-backdrop.active { opacity: 1; visibility: visible; }
    .modal-content {
      background: #2c2c2e;
      border-radius: 12px;
      padding: 0.8rem 1.2rem;
      max-width: 400px;
      width: 90%;
      position: relative;
      color: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      font-size: 0.8rem;
    }
    .modal-content h3 {
      margin-bottom: 0.8rem;
      font-weight: 600;
    }
    .modal-content label {
      display: inline-block;
      margin-right: 0.4rem;
      font-weight: 500;
      margin-top: 0.5rem;
    }
    .modal-content input,
    .modal-content select {
      margin-bottom: 0.8rem;
      padding: 0.3rem 0.5rem;
      border: 1px solid #555;
      border-radius: 6px;
      width: 100%;
      margin-top: 0.3rem;
      background-color: #1c1c1e;
      color: #fff;
    }
    .modal-content button {
      background-color: var(--highlight-color);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 0.3rem 0.5rem;
      cursor: pointer;
      margin-right: 0.4rem;
    }
    .modal-content button:hover { opacity: 0.9; }
    .close-modal-btn {
      background: none;
      color: #fff;
      position: absolute;
      top: 6px;
      right: 6px;
      font-size: 1.2rem;
      cursor: pointer;
      border: none;
    }
    .close-modal-btn:hover { color: #bbb; }

    /* --------------------------------------------------
       Delete Image Feature
    -------------------------------------------------- */
    .sidebar-footer button.delete-btn {
      background-color: #ff9a9a; /* Pastel red */
      color: #333;
    }
    .image-container.selectable {
      position: relative;
    }
    .image-container.selectable::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 154, 154, 0.2);
      border: 2px dashed #ff9a9a;
      border-radius: 6px;
      z-index: 1;
      pointer-events: none;
    }
    .image-container.selected::before {
      background-color: rgba(255, 154, 154, 0.5);
      border: 2px solid #ff5555;
    }
    .delete-controls {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(44,44,46,0.9);
      padding: 0.5rem 1rem;
      border-radius: 10px;
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .delete-controls.active {
      display: flex;
    }
    .delete-controls button {
      background-color: #ff5555;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
    }
    .delete-controls button.cancel {
      background-color: #555;
    }

    /* --------------------------------------------------
       Move Image Feature
    -------------------------------------------------- */
    .sidebar-footer button.move-btn {
      background-color: #90caf9; /* Pastel blue */
      color: #333;
    }
    .image-container.move-selectable {
      position: relative;
    }
    .image-container.move-selectable::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(144, 202, 249, 0.2);
      border: 2px dashed #90caf9;
      border-radius: 6px;
      z-index: 1;
      pointer-events: none;
    }
    .image-container.move-selected::before {
      background-color: rgba(144, 202, 249, 0.5);
      border: 2px solid #2196f3;
    }
    .move-controls {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(44,44,46,0.9);
      padding: 0.5rem 1rem;
      border-radius: 10px;
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    .move-controls.active {
      display: flex;
    }
    .move-controls button {
      background-color: #2196f3;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
    }
    .move-controls button.cancel {
      background-color: #555;
    }
    #moveDestinationSelect {
      font-size: 1.2em;
      padding: 0.6rem 0.7rem;
      margin-bottom: 1.2rem;
    }

    /* ADMIN FEATURE ADDED: Hide admin buttons by default */
    .admin-only {
      display: none; /* Hidden unless admin-logged in */
    }

    /* ADMIN FEATURE ADDED: Admin Login Modal */
    #adminLoginModal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.3);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    #adminLoginModal.active {
      opacity: 1;
      visibility: visible;
    }
    #adminLoginModal .modal-content {
      background: #2c2c2e;
      border-radius: 12px;
      padding: 1rem 1.2rem;
      max-width: 350px;
      width: 90%;
      position: relative;
      color: #fff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      font-size: 0.85rem;
    }
    #adminLoginModal h3 {
      margin-bottom: 0.8rem;
      font-weight: 600;
    }
    #adminLoginModal input[type="password"] {
      width: 100%;
      padding: 0.4rem;
      margin-bottom: 0.8rem;
      border: 1px solid #555;
      border-radius: 6px;
      background-color: #1c1c1e;
      color: #fff;
    }
    #adminLoginModal .close-modal-btn {
      background: none;
      color: #fff;
      position: absolute;
      top: 6px; 
      right: 6px;
      font-size: 1.2rem;
      cursor: pointer; 
      border: none;
    }
    #adminLoginModal .close-modal-btn:hover {
      color: #bbb;
    }

  </style>
</head>
<body>

  <!-- TOP BAR -->
  <div class="top-bar">
    <!-- ADMIN FEATURE ADDED: Admin login button -->
    <button id="adminLoginOpenBtn">ADMIN</button>
    
    <!-- Mark these as admin-only -->
    <button id="openFolderModalBtn" class="admin-only">New Folder</button>
    <button id="openImageModalBtn" class="admin-only">Add Image</button>
  </div>

  <!-- MAIN CONTAINER (Sidebar + Main Content) -->
  <div class="main-container">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="search-bar-container">
        <input type="search" id="imageSearch" placeholder="Search images...">
        <div class="filter-icon-container">
          <button class="filter-button" id="filterButton" title="Sort Options">
            <svg viewBox="0 0 24 24">
              <path d="M3 6h18M3 12h18M3 18h18"
                    stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            </svg>
          </button>
        </div>
      </div>
      <!-- Filter menu positioned outside the sidebar -->
      <div class="filter-menu" id="filterMenu">
        <div class="filter-option" data-sort="alphabetical">Alphabetical</div>
        <div class="filter-option" data-sort="recent">Recent Add</div>
      </div>
      <ul class="folder-list" id="folderList">
        <!-- Dynamically generated folder items will appear here -->
      </ul>
      <div class="sidebar-footer">
        <!-- Mark these as admin-only, so they're hidden unless admin logs in -->
        <button id="moveImageBtn" class="move-btn admin-only">Move Images</button>
        <button id="deleteImageBtn" class="delete-btn admin-only">Delete Images</button>
        <button id="renameFolderBtn" class="admin-only">Rename Folder</button>
        <button id="deleteFolderBtn" class="admin-only">Delete Folder</button>
      </div>
    </div>

    <div class="move-controls" id="moveControls">
      <span id="moveSelectedCount">0 selected</span>
      <button id="confirmMoveImagesBtn">Select Destination</button>
      <button id="cancelMoveImagesBtn" class="cancel">Cancel</button>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
      <div class="gallery" id="gallery"></div>
    </div>
  </div>

  <!-- FLOATING SIZE PANEL -->
  <div class="floating-size-panel">
    <div class="size-icon-container">
      <div class="size-icon" data-size="120"><span>XS</span></div>
      <div class="size-icon" data-size="200"><span>S</span></div>
      <div class="size-icon selected" data-size="300"><span>M</span></div>
      <div class="size-icon" data-size="400"><span>L</span></div>
      <div class="size-icon" data-size="500"><span>XL</span></div>
    </div>
  </div>

  <!-- MODAL: New Folder -->
  <div class="modal-backdrop" id="folderModal">
    <div class="modal-content">
      <button class="close-modal-btn" id="closeFolderModalBtn">&times;</button>
      <h3>Create New</h3>
      <label for="newFolderName">Name:</label>
      <input type="text" id="newFolderName" placeholder="e.g., My Textures">
      <label for="parentFolderSelect">Parent (optional):</label>
      <select id="parentFolderSelect">
        <option value="">No Parent</option>
      </select>
      <div style="margin-top:0.8rem;">
        <button id="addFolderBtn">Add</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Add Image (Only Upload Interface) -->
  <div class="modal-backdrop" id="imageModal">
    <div class="modal-content">
      <button class="close-modal-btn" id="closeImageModalBtn">&times;</button>
      <h3>Add Image</h3>
      <label for="fileInput">Select Image:</label>
      <input type="file" id="fileInput" accept="image/*">
      <label for="folderSelect">Location:</label>
      <select id="folderSelect"></select>
      <label for="imageKeywords">Keywords:</label>
      <input type="text" id="imageKeywords" placeholder="e.g., red, green">
      <div style="margin-top:0.8rem;">
        <button id="confirmAddImageBtn">Add</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Rename Folder -->
  <div class="modal-backdrop" id="renameFolderModal">
    <div class="modal-content">
      <button class="close-modal-btn" id="closeRenameFolderModalBtn">&times;</button>
      <h3>Rename Folder</h3>
      <label for="renameFolderInput">New Name:</label>
      <input type="text" id="renameFolderInput" placeholder="Enter new folder name">
      <div style="margin-top:0.8rem;">
        <button id="confirmRenameFolderBtn">Rename</button>
      </div>
    </div>
  </div>

  <!-- MOVING DESTINATION MODAL -->
  <div class="modal-backdrop" id="moveDestinationModal">
    <div class="modal-content">
      <button class="close-modal-btn" id="closeMoveDestinationModalBtn">&times;</button>
      <h3>Move Images</h3>
      <p style="margin-bottom: 0.8rem;">Select destination folder:</p>
      <select id="moveDestinationSelect" style="margin-bottom: 1rem;"></select>
      <div style="margin-top:0.8rem;">
        <button id="confirmMoveDestinationBtn">Move</button>
      </div>
    </div>
  </div>

  <!-- DELETE CONTROLS -->
  <div class="delete-controls" id="deleteControls">
    <span id="selectedCount">0 selected</span>
    <button id="confirmDeleteImagesBtn">Delete Selected</button>
    <button id="cancelDeleteImagesBtn" class="cancel">Cancel</button>
  </div>

  <!-- ADMIN FEATURE ADDED: Admin Login Modal -->
  <div class="modal-backdrop" id="adminLoginModal">
    <div class="modal-content">
      <button class="close-modal-btn" id="closeAdminLoginModalBtn">&times;</button>
      <h3>Admin Login</h3>
      <input type="password" id="adminPasswordInput" placeholder="Enter admin password">
      <button id="adminLoginBtn">Login</button>
    </div>
  </div>

  <!-- Load Firebase SDKs via CDN (Global Approach) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script>
    /* Everything else from your existing script remains unchanged, except we add
       a few lines for the ADMIN FEATURE.
       The lines are marked with comments for clarity. */

    /* ADMIN FEATURE ADDED: track admin status */
    let isAdmin = false; 

    // ADMIN references
    const adminLoginOpenBtn = document.getElementById('adminLoginOpenBtn');
    const adminLoginModal = document.getElementById('adminLoginModal');
    const closeAdminLoginModalBtn = document.getElementById('closeAdminLoginModalBtn');
    const adminPasswordInput = document.getElementById('adminPasswordInput');
    const adminLoginBtn = document.getElementById('adminLoginBtn');

    // A function to show/hide the admin-only elements
    function updateAdminUI() {
      const adminEls = document.querySelectorAll('.admin-only');
      adminEls.forEach(el => {
        el.style.display = isAdmin ? 'inline-block' : 'none';
      });
    }

    // Open admin login modal
    adminLoginOpenBtn.addEventListener('click', () => {
      adminLoginModal.classList.add('active');
    });

    // Close admin login modal
    closeAdminLoginModalBtn.addEventListener('click', () => {
      adminLoginModal.classList.remove('active');
      adminPasswordInput.value = '';
    });
    adminLoginModal.addEventListener('click', (e) => {
      if (e.target === adminLoginModal) {
        adminLoginModal.classList.remove('active');
        adminPasswordInput.value = '';
      }
    });

    // Attempt admin login with a hardcoded password
    adminLoginBtn.addEventListener('click', () => {
      const typedPassword = adminPasswordInput.value.trim();
      const correctPassword = '1905'; /* <--- Hardcoded for demonstration */
      
      if (typedPassword === correctPassword) {
        isAdmin = true;
        updateAdminUI();
        adminLoginModal.classList.remove('active');
        adminPasswordInput.value = '';
      } else {
        alert('Incorrect password');
      }
    });

    /* REST OF YOUR EXISTING CODE FOLLOWS HERE:
       (Firebase config, let folders, const db, isDeleteMode, etc.)
       Make sure you do not remove or reorder them, just keep them
       exactly as you had. I've shown them in short form here, but
       you would keep your entire script content below. */

    // Initialize Firebase with your configuration (the code you already have)
    const firebaseConfig = {
      apiKey: "AIzaSyBs3677...",
      authDomain: "referencesadrien...",
      projectId: "referencesadrien",
      storageBucket: "referencesadrien.firebasestorage.app",
      messagingSenderId: "954877853554",
      appId: "1:954877853554:web:4492547898026cf1afe7eb"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

    // All your existing script: variables, event listeners, Netlify upload function,
    // Firestore read/write, toggleDeleteMode, toggleMoveMode, etc. remain exactly the same.
    // (We won't rewrite them here for brevity.)

    // Then, inside document.addEventListener('DOMContentLoaded'...) we call updateAdminUI() at the end:
    document.addEventListener("DOMContentLoaded", async () => {
      // ... your existing DOMContentLoaded logic ...
      // e.g. loadFoldersFromFirebase(), loadImagesFromFirebase(), etc.

      // ADMIN FEATURE ADDED: ensure the UI is updated on load
      updateAdminUI();
    });
  </script>
</body>
</html>
